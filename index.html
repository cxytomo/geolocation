<!DOCTYPE HTML>
<html>
<head>
	<title>Geolocation</title>
</head>
<body>
	<form>
	  <fieldset class="basic">
	    <legend>Basic Geolocation Data</legend>
		<input type="button" id="go" value="Click Me To View Your Location" />
	  </fieldset>
	  <fieldset class="inv_geocode">
	  	<legend>Inverse Geocode</legend>
	  	<input type="button" id="addr" value="Click Me To View Your Address" />
	  </fieldset>
	</form>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.js"></script>
<script>window.jQuery || document.write("<script src='jquery-1.8.2.js'>\x3c/script>")</script>
<script src="http://j.maxmind.com/app/geoip.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script>
//1.test if access to html5 geolocation
//2.then get the basic geolocation data
//3.append it to document to display it.
$(document).ready(function(){
	$('#go').click(function(){
		if(navigator && navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(geo_success, geo_fail);
		} else {
			printLatLng(geoip_latitude(), geoip_longitude(), true);
		}
	});
	$('#addr').click(function(e){
		if(navigator && navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(geotoaddr_success, geotoaddr_fail);
		} else {
			printAddr(geoip_latitude(), geoip_longitude(), true);
		}
	});
});
function geo_success(position) {
	printLatLng(position.coords.latitude, position.coords.longitude, false);
}
function geo_fail(error) {
	console.log(error);
	console.log(error.code);
/*	while failing to get the current location,it return an error object,with property code to present the reason why it failed.
	switch(error.code) {
		case 1: error('The user denied the request for location information.');break;
		case 2: error('Your location information is unavailable.');break;
		case 3: error('The request to get your location timed out.');break;
		default: error('An unknown error occurred while requesting your location.');
	}
*/
	printLatLng(geoip_latitude(), geoip_longitude(), true);
	
}
function printLatLng(latitude, longitude,isMaxMind) {
	$('body').append('<p>Your latitude:</br>' + latitude + '</p>');
	$('body').append('<p>Your longtitude:</br>' + longitude + '</p>');
	//it's needed if you want free support from maxmind
	if(isMaxMind) {
	$('body').append('<p><a href="http://www.maxmind.com" target="_blank">IP to Location Service provided by MaxMind</a></p>');
	}
}
function geotoaddr_success(position) {
	printAddr(position.coords.latitude, position.coords.longitude, false);
}
function geotoaddr_fail(error) {
	printAddr(geoip_latitude(), geoip_longitude, true);
}
function printAddr(latitude, longitude, isMaxMind) {
	var geocoder = new google.maps.Geocoder();
	var yourLocation = new google.maps.LatLng(latitude, longitude);
	geocoder.geocode({'latlng':yourLocation}, function(results, status){
		if(status == google.maps.GeocoderStatus.OK) {
			if(results[0]) {
				$('body').append('<p>Your address:</br>' + results[0] +'</p>');
			} else( error("Google didn't return any results."));
		} else {
			error("Reverse Geocoding failed due to:" + status);
		}
	});
	if(isMaxMind) {
		$('body').append('<p><a href="http://www.maxmind.com" target="_blank">IP to Location Service provided by MaxMind</a></p>');
	}
}
function error(msg) {
	alert(msg);
}
</script>
</body>
</html>